


pipeline {
    agent any
    
    environment {
        props = load 'general.groovy'
	filename = '/export/home/webadmin/.jenkins/jobs/mk245-test-folder/jobs/jasper-report-job/workspace/ExtensionCode/PickListReport/TMW/PickListReport.zip'
	}
    parameters {
    	gitParameter branchFilter: 'origin/(.*)', defaultValue: 'test2-jenkin', name: 'BRANCH', type: 'PT_BRANCH'
  	}
    options {
        skipStagesAfterUnstable()
    	    }
	    
    stages {
        stage('Build') {
            steps {
                echo "Building from branch ${params.BRANCH}"
		git branch: "${params.BRANCH}",
                credentialsId: 'test',
                url: 'https://github.com/bimsoft/Employment_proj.git'
		echo "${WORKSPACE}"
		sh 'ls -lrt'
		
		script {
			echo "parameter name...................${params.folder}"
		
			if (params.folder == "Parent") {
				echo " Parent selected"
			} else {
				echo " ${params.folder} selected"
			}
		} 
		
   		   
            }
        }
	
        stage('creating zip') {
            steps {
                echo 'Testing'
                //zip zipFile: 'todo-api.zip', dir:'todo-api' 
		//sh 'zip todo-api.zip todo-api'
		//sh "ls -lrt \${WORKSPACE}"  
            }
        }
        stage('Deploy') {
            steps {
	        script {
			//sh "curl -H \"Accept:application/json\" -H \"Authorization: Basic `echo -n omnicomponent.1.0.0:b4s8rgTyg55XYNun | base64`\" -X POST 'https://tssls-auth.omni.manh.com/oauth/token?grant_type=password&username=admin@TMW.com&password=Password1"'!'"'"
			//sh('curl -b session -X POST http://deployhub.openmakesoftware.com/API/UserProfile?user=admin')
			//def response = httpRequest "https://reqres.in/api/users?page=${env.page}"
			//def response = httpRequest authentication: 'cred', url: "https://tssls-auth.omni.manh.com/oauth/token?grant_type=password&username=admin@TMW.com&password=Password1!"
			def apiurl = "https://jsonplaceholder.typicode.com/posts/1"
			def response = sh(returnStdout: true, script: "curl -s -H \"Content-type: application/json\" -X GET ${apiurl}").trim()
			def t_act = sh(returnStdout: true, script: "echo ${response}")
			
			//def act = sh(returnStdout: true, script: "${t_act: -1}")
			
			//println('Status: '+response.status)
			//println('Response: '+response.content)
			//echo "Password is --- ${env.pass}"
			//echo "User Name is -- ${env.page}"
			//echo props['pass']
			//echo "This is result ${t_act}"
			}
            }
        }
    }
    post {
    	always {
		echo "Wow.... Deleting Zip file from \${WORKSPACE}"
		sh "rm -rf \${WORKSPACE}/todo-api.zip"
		}
	}
}
