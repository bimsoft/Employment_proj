
pipeline {
    agent any
    options {
        skipStagesAfterUnstable()
    }
    stages {
        stage('Build') {
            steps {
                echo 'Building'
		git branch: 'mk245-jaspertest-2',
                credentialsId: 'mktest',
                url: 'https://github.com/MensWearhouse/eom.git'
			    sh 'ls -lrt ExtensionCode/PickListReport/TMW/PickListReport'    
            }
        }
        stage('creating zip') {
            steps {
                echo 'Testing'
                def filename = '/export/home/webadmin/.jenkins/jobs/mk245-test-folder/jobs/jasper-report-job/workspace/ExtensionCode/PickListReport/TMW/PickListReport.zip'
				if (fileExists(filename))
				    {
					    sh "rm  \${filename}"
				    	zip zipFile: 'PickListReport.zip', dir:'ExtensionCode/PickListReport/TMW/PickListReport'
          
		    } 
		else{
			zip zipFile: 'PickListReport.zip', dir:'ExtensionCode/PickListReport/TMW/PickListReport'
           	}    
                echo "END - ZIP"
				sh 'ls -lrt ExtensionCode/PickListReport/TMW'    
            }
        }
        stage('Deploy') {
            steps {
                //sh "curl -v https://tssls.omni.manh.com/oauth/token?grant_type=password&username=admin@TMW.com&password=Password1!")
				//sh('curl -b session -X POST http://deployhub.openmakesoftware.com/API/UserProfile?user=admin')
				def response = httpRequest "https://tssls.omni.manh.com/oauth/token?grant_type=password&username=admin@TMW.com&password=Password1!"
				println('Status: '+response.status)
				println('Response: '+response.content)
            }
        }
    }
}
